- hosts:
  - "{{ host | default('ams3') }}"

  # Instead of root using local user
  # reference: https://stackoverflow.com/questions/21422158/ansible-accessing-local-environment-variables
  become: true
  vars:
    local_user: "{{ lookup('env', 'USER') }}"
  become_user: "{{ local_user }}"
  become_method: sudo

  pre_tasks:
    - name: Create a linux user
      user:
        name: "{{ username }}"
        create_home: yes
        # The user should be created if it doesn't exist or updated if it already exists
        state: present

    - name: Create release-manager group
      group:
        name: release-manager
        state: present

    - name: Add user to release-manager group
      user:
        name: "{{ username }}"
        groups: "release-manager"
        append: yes

  roles:
    - role: add_ssh_key
    - role: add_GA_file


- hosts:
  - download_service
  become: true
  vars:
    local_user: "{{ lookup('env', 'USER') }}"
  become_user: "{{ local_user }}"
  become_method: sudo
  pre_tasks:
    - name: Create a linux user
      user:
        name: "{{ username }}"
        create_home: yes
        # The user should be created if it doesn't exist or updated if it already exists
        state: present

    - name: Create release-manager group
      group:
        name: release-manager
        state: present

    - name: Add user to release-manager group
      user:
        name: "{{ username }}"
        groups: "release-manager"
        append: yes

  roles:
    - role: add_ssh_key