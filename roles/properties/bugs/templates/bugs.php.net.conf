<VirtualHost *:80>
	# Host and Document Root
	ServerName {{ bugs_domain }}
	ServerAlias {{ bugs_domain_alias }}
	Redirect / https://{{ bugs_domain }}/

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ bugs_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ bugs_domain }}-access.log combined
</VirtualHost>

<VirtualHost *:443>
	# Host and Document Root
	ServerName {{ bugs_domain }}
	ServerAlias {{ bugs_domain_alias }}
	DocumentRoot {{ bugs_docroot }}/{{ bugs_domain }}/www

	<Directory {{ bugs_docroot }}/{{ bugs_domain }}/>
		Options FollowSymLinks MultiViews
		AllowOverride None
		Require all granted
	</Directory>

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ bugs_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ bugs_domain }}-access.log combined

	# TLS Configuration with self-signed certificates
	SSLEngine on
	SSLCertificateFile /etc/ssl/certs/php-self-signed.crt
	SSLCertificateKeyFile /etc/ssl/certs/php-self-signed.key

	# Environment Variables
	SetEnv AUTH_TOKEN "{{ bugs_auth_token }}"
	SetEnv USER_TOKEN "{{ main_user_token }}"
	SetEnv USER_PWD_SALT "{{ bugs_password_salt }}"

	# PHP Settings
	php_value date.timezone UTC

	# Rewrite Rules
	RewriteEngine On
	RewriteRule /([0-9]+)/*$ /bug.php?id=$1 [R]

	ErrorDocument 404 /index.php
</VirtualHost>
