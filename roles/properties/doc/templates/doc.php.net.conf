<VirtualHost *:80>
	# Host and Document Root
	ServerName {{ doc_domain }}
	ServerAlias {{ doc_domain_alias }}
	Redirect / https://{{ doc_domain }}/

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ doc_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ doc_domain }}-access.log combined
</VirtualHost>

<VirtualHost *:443>
	# Host and Document Root
	ServerName {{ doc_domain }}
	ServerAlias {{ doc_domain_alias }}
	DocumentRoot {{ doc_docroot }}/{{ doc_domain }}/www

	<Directory {{ doc_docroot }}/{{ doc_domain }}/>
		Require all granted
	</Directory>

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ doc_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ doc_domain }}-access.log combined

	# TLS Configuration with self-signed certificates
	SSLEngine on
	SSLCertificateFile /etc/ssl/certs/php-self-signed.crt
	SSLCertificateKeyFile /etc/ssl/certs/php-self-signed.key

	# Environment Variables
	SetEnv BASE_DOCS_PATH "{{ doc_box_dir }}/src/phpdoc/langs/base/docs"
	SetEnv PHPDOC_GIT_DIR "{{ doc_lang_sources_dir }}"
	SetEnv SQLITE_DIR "{{ doc_sqlite_dir }}"

	# Rewrite Rules
	RewriteEngine On
	RewriteRule  ^/tutorial(.*)\.php$  /guide$1.md [R]
	RewriteRule  ^/tutorial(.*)$  /guide$1 [R]
	RewriteRule  ^/guide$ /guide/ [R]
	RewriteRule  ^/guide(/(.*))$  %{DOCUMENT_ROOT}/guide.php?chapter=$2  [L]

	# Error Documents
	ErrorDocument 403 /error.php
	ErrorDocument 404 /error.php
</VirtualHost>
