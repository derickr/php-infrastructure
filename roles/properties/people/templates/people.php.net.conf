<VirtualHost *:80>
	# Host and Document Root
	ServerName {{ people_domain }}
	ServerAlias {{ people_domain_alias }}
	Redirect / https://{{ people_domain }}/

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ people_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ people_domain }}-access.log combined
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
	# Host and Document Root
	ServerName {{ people_domain }}
	ServerAlias {{ people_domain_alias }}
	DocumentRoot {{ people_docroot }}/{{ people_domain }}

	<Directory {{ people_docroot }}/{{ people_domain }}/>
		Require all granted
	</Directory>

	# Logging
	ErrorLog ${APACHE_LOG_DIR}/{{ people_domain }}-error.log
	CustomLog ${APACHE_LOG_DIR}/{{ people_domain }}-access.log combined

	# TLS Configuration with self-signed certificates
	SSLEngine on
	SSLCertificateFile /etc/ssl/certs/php-self-signed.crt
	SSLCertificateKeyFile /etc/ssl/certs/php-self-signed.key

	# Property Specific Changes
	php_value filter.default special_chars

	RewriteEngine On
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule ^/?([^/\.]+)/?$ /user.php?username=$1 [L,QSA]

	# Environment Variables
	SetEnv TOKEN "{{ main_user_token }}"
</VirtualHost>
</IfModule>
