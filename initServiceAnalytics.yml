# Run this playbook to set up your downloads machine
# ansible-playbook initServiceAnalytics.yml

- hosts:
  - analytics

  become: yes
  become_user: root
  gather_facts: true

  pre_tasks:
    - name: Gather facts for rsync server
      setup:
        gather_subset:
          - default_ipv4
      delegate_to: "{{ item }}"
      delegate_facts: true
      loop: "{{ groups['rsync'] }}"

    - name: Install common software and configuration
      include_role:
        name: install_common_software

    - name: Install Apache and common modules
      include_role:
        name: add_apache_with_modules

    - name: Install MariaDB
      include_role:
        name: install_mariadb

    - name: Install Composer
      include_role:
        name: install_composer

  roles:
    - role: properties/analytics
