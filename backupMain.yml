- hosts:
  - main
  become: yes
  become_user: root
  environment:
    AWS_ACCESS_KEY_ID: "{{ DO_access_key }}"
    AWS_SECRET_ACCESS_KEY: "{{ DO_secret_key }}"
    RESTIC_PASSWORD: "{{ restic_password }}"
  roles:
    - role: backup
      vars:
        service: main
        backup_name: "main-{{ ansible_date_time.date }}"
        backup_dir: /local/backups
        base_dir: /local

- hosts:
  - downloads
  become: yes
  become_user: root
  environment:
    AWS_ACCESS_KEY_ID: "{{ DO_access_key }}"
    AWS_SECRET_ACCESS_KEY: "{{ DO_secret_key }}"
    RESTIC_PASSWORD: "{{ restic_password }}"
  roles:
    - role: backup
      vars:
        service: downloads
        backup_name: "downloads-{{ ansible_date_time.date }}"
        backup_dir: /local/backups
        base_dir: /local

- hosts:
  - wiki
  become: yes
  become_user: root
  environment:
    AWS_ACCESS_KEY_ID: "{{ DO_access_key }}"
    AWS_SECRET_ACCESS_KEY: "{{ DO_secret_key }}"
    RESTIC_PASSWORD: "{{ restic_password }}"
  roles:
    - role: backup
      vars:
        service: wiki
        backup_name: "wiki-{{ ansible_date_time.date }}"
        backup_dir: /local/backups
        base_dir: /local
